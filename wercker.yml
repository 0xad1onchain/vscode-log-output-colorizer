box: bluemixcode/node-xvfb
build:
  steps:
    - script:
        name: start xvfb
        code: |
          echo "unsafe-perm=true" >> .npmrc
          cat .npmrc
          git submodule update --init --recursive
          export DISPLAY=:99.0
          start-stop-daemon --start --pidfile /tmp/xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -screen 0 1024x768x24 -ac +extension GLX +render -noreset
          sleep 3
    - script:
        name: install dependencies
        code: |
          export NODE_ENV=test
          npm install -g mocha gulp
          npm install -g vsce
          npm install
          npm link gulp
    - script:
        name: linting
        code: |
          gulp hygiene
    - script:
        name: compile
        code: |
          npm run compile
    - script:
        name: tests
        code: |
          npm test
    - script:
        name: build binary
        code: |
          vsce package